---
data:
  _extendedDependsOn: []
  _extendedRequiredBy:
  - icon: ':x:'
    path: convex/dynamic_lichao.hpp
    title: convex/dynamic_lichao.hpp
  - icon: ':heavy_check_mark:'
    path: convex/slope_trick/slope_super.hpp
    title: convex/slope_trick/slope_super.hpp
  - icon: ':question:'
    path: ds/binary_trie.hpp
    title: ds/binary_trie.hpp
  - icon: ':x:'
    path: ds/dynamic_array.hpp
    title: ds/dynamic_array.hpp
  - icon: ':x:'
    path: ds/meldable_heap.hpp
    title: ds/meldable_heap.hpp
  - icon: ':warning:'
    path: ds/piecewise_constant/piecewise_constant.hpp
    title: ds/piecewise_constant/piecewise_constant.hpp
  - icon: ':warning:'
    path: ds/piecewise_constant/piecewise_constant_acted.hpp
    title: ds/piecewise_constant/piecewise_constant_acted.hpp
  - icon: ':warning:'
    path: ds/piecewise_constant/piecewise_constant_acted_RMQ.hpp
    title: ds/piecewise_constant/piecewise_constant_acted_RMQ.hpp
  - icon: ':warning:'
    path: ds/piecewise_constant/piecewise_constant_basic.hpp
    title: ds/piecewise_constant/piecewise_constant_basic.hpp
  - icon: ':heavy_check_mark:'
    path: ds/randomized_bst/rbst.hpp
    title: ds/randomized_bst/rbst.hpp
  - icon: ':question:'
    path: ds/randomized_bst/rbst_acted_monoid.hpp
    title: ds/randomized_bst/rbst_acted_monoid.hpp
  - icon: ':heavy_check_mark:'
    path: ds/randomized_bst/rbst_acted_set.hpp
    title: ds/randomized_bst/rbst_acted_set.hpp
  - icon: ':heavy_check_mark:'
    path: ds/randomized_bst/rbst_commutative_monoid.hpp
    title: ds/randomized_bst/rbst_commutative_monoid.hpp
  - icon: ':question:'
    path: ds/randomized_bst/rbst_monoid.hpp
    title: ds/randomized_bst/rbst_monoid.hpp
  - icon: ':warning:'
    path: ds/segtree/dynamic_dual_segtree.hpp
    title: ds/segtree/dynamic_dual_segtree.hpp
  - icon: ':question:'
    path: ds/segtree/dynamic_lazy_segtree.hpp
    title: ds/segtree/dynamic_lazy_segtree.hpp
  - icon: ':x:'
    path: ds/segtree/sortable_segtree.hpp
    title: ds/segtree/sortable_segtree.hpp
  - icon: ':question:'
    path: ds/sortable_array.hpp
    title: ds/sortable_array.hpp
  - icon: ':question:'
    path: ds/splaytree/splaytree.hpp
    title: ds/splaytree/splaytree.hpp
  - icon: ':question:'
    path: ds/splaytree/splaytree_acted_monoid.hpp
    title: ds/splaytree/splaytree_acted_monoid.hpp
  - icon: ':heavy_check_mark:'
    path: ds/splaytree/splaytree_acted_set.hpp
    title: ds/splaytree/splaytree_acted_set.hpp
  - icon: ':heavy_check_mark:'
    path: ds/splaytree/splaytree_basic.hpp
    title: ds/splaytree/splaytree_basic.hpp
  - icon: ':question:'
    path: ds/splaytree/splaytree_commutative_monoid.hpp
    title: ds/splaytree/splaytree_commutative_monoid.hpp
  - icon: ':question:'
    path: ds/splaytree/splaytree_monoid.hpp
    title: ds/splaytree/splaytree_monoid.hpp
  - icon: ':x:'
    path: ds/unionfind/dynamic_unionfind.hpp
    title: ds/unionfind/dynamic_unionfind.hpp
  - icon: ':heavy_check_mark:'
    path: geo/polygon_triangulation.hpp
    title: geo/polygon_triangulation.hpp
  - icon: ':x:'
    path: graph/shortest_path/K_shortest_walk.hpp
    title: graph/shortest_path/K_shortest_walk.hpp
  - icon: ':warning:'
    path: seq/cycle_decomposition.hpp
    title: seq/cycle_decomposition.hpp
  - icon: ':warning:'
    path: string/aho_corasick_for_general_trie.hpp
    title: string/aho_corasick_for_general_trie.hpp
  _extendedVerifiedWith:
  - icon: ':heavy_check_mark:'
    path: test/1_mytest/ARC30D.test.cpp
    title: test/1_mytest/ARC30D.test.cpp
  - icon: ':heavy_check_mark:'
    path: test/1_mytest/binary_trie.test.cpp
    title: test/1_mytest/binary_trie.test.cpp
  - icon: ':heavy_check_mark:'
    path: test/1_mytest/cf702_F.test.cpp
    title: test/1_mytest/cf702_F.test.cpp
  - icon: ':heavy_check_mark:'
    path: test/1_mytest/cf702_F_splay.test.cpp
    title: test/1_mytest/cf702_F_splay.test.cpp
  - icon: ':heavy_check_mark:'
    path: test/1_mytest/dynamic_lazy_segtree.test.cpp
    title: test/1_mytest/dynamic_lazy_segtree.test.cpp
  - icon: ':heavy_check_mark:'
    path: test/1_mytest/dynamic_lazy_segtree_persistent.test.cpp
    title: test/1_mytest/dynamic_lazy_segtree_persistent.test.cpp
  - icon: ':heavy_check_mark:'
    path: test/1_mytest/polygon_triangulation.test.cpp
    title: test/1_mytest/polygon_triangulation.test.cpp
  - icon: ':heavy_check_mark:'
    path: test/1_mytest/rbst.test.cpp
    title: test/1_mytest/rbst.test.cpp
  - icon: ':heavy_check_mark:'
    path: test/1_mytest/rbst_am.test.cpp
    title: test/1_mytest/rbst_am.test.cpp
  - icon: ':heavy_check_mark:'
    path: test/1_mytest/rbst_am_2.test.cpp
    title: test/1_mytest/rbst_am_2.test.cpp
  - icon: ':heavy_check_mark:'
    path: test/1_mytest/rbst_am_persistent.test.cpp
    title: test/1_mytest/rbst_am_persistent.test.cpp
  - icon: ':heavy_check_mark:'
    path: test/1_mytest/rbst_commutative_persistent.test.cpp
    title: test/1_mytest/rbst_commutative_persistent.test.cpp
  - icon: ':heavy_check_mark:'
    path: test/1_mytest/rbst_monoid.test.cpp
    title: test/1_mytest/rbst_monoid.test.cpp
  - icon: ':heavy_check_mark:'
    path: test/1_mytest/rbst_monoid_2.test.cpp
    title: test/1_mytest/rbst_monoid_2.test.cpp
  - icon: ':heavy_check_mark:'
    path: test/1_mytest/rbst_monoid_persistent.test.cpp
    title: test/1_mytest/rbst_monoid_persistent.test.cpp
  - icon: ':heavy_check_mark:'
    path: test/1_mytest/rbst_test.test.cpp
    title: test/1_mytest/rbst_test.test.cpp
  - icon: ':heavy_check_mark:'
    path: test/1_mytest/slope_super.test.cpp
    title: test/1_mytest/slope_super.test.cpp
  - icon: ':heavy_check_mark:'
    path: test/1_mytest/sortable_array.test.cpp
    title: test/1_mytest/sortable_array.test.cpp
  - icon: ':heavy_check_mark:'
    path: test/1_mytest/splay.test.cpp
    title: test/1_mytest/splay.test.cpp
  - icon: ':heavy_check_mark:'
    path: test/1_mytest/splay_am.test.cpp
    title: test/1_mytest/splay_am.test.cpp
  - icon: ':heavy_check_mark:'
    path: test/1_mytest/splay_cm.test.cpp
    title: test/1_mytest/splay_cm.test.cpp
  - icon: ':heavy_check_mark:'
    path: test/1_mytest/splay_monoid.test.cpp
    title: test/1_mytest/splay_monoid.test.cpp
  - icon: ':x:'
    path: test/2_library_checker/data_structure/dynamic_sequence_range_affine_range_sum_rbst.test.cpp
    title: test/2_library_checker/data_structure/dynamic_sequence_range_affine_range_sum_rbst.test.cpp
  - icon: ':x:'
    path: test/2_library_checker/data_structure/dynamic_sequence_range_affine_range_sum_splay.test.cpp
    title: test/2_library_checker/data_structure/dynamic_sequence_range_affine_range_sum_splay.test.cpp
  - icon: ':x:'
    path: test/2_library_checker/data_structure/line_add_get_min_lichao.test.cpp
    title: test/2_library_checker/data_structure/line_add_get_min_lichao.test.cpp
  - icon: ':x:'
    path: test/2_library_checker/data_structure/persistent_queue.test.cpp
    title: test/2_library_checker/data_structure/persistent_queue.test.cpp
  - icon: ':x:'
    path: test/2_library_checker/data_structure/persistent_range_affine_range_sum.test.cpp
    title: test/2_library_checker/data_structure/persistent_range_affine_range_sum.test.cpp
  - icon: ':x:'
    path: test/2_library_checker/data_structure/persistent_unionfind.test.cpp
    title: test/2_library_checker/data_structure/persistent_unionfind.test.cpp
  - icon: ':x:'
    path: test/2_library_checker/data_structure/range_reverse_range_sum.test.cpp
    title: test/2_library_checker/data_structure/range_reverse_range_sum.test.cpp
  - icon: ':x:'
    path: test/2_library_checker/data_structure/segment_add_get_min.test.cpp
    title: test/2_library_checker/data_structure/segment_add_get_min.test.cpp
  - icon: ':x:'
    path: test/2_library_checker/data_structure/set_xor_min.test.cpp
    title: test/2_library_checker/data_structure/set_xor_min.test.cpp
  - icon: ':x:'
    path: test/2_library_checker/data_structure/sort_segtree.test.cpp
    title: test/2_library_checker/data_structure/sort_segtree.test.cpp
  - icon: ':x:'
    path: test/2_library_checker/data_structure/sort_segtree_1.test.cpp
    title: test/2_library_checker/data_structure/sort_segtree_1.test.cpp
  - icon: ':x:'
    path: test/2_library_checker/graph/K_shortest_walk.test.cpp
    title: test/2_library_checker/graph/K_shortest_walk.test.cpp
  - icon: ':x:'
    path: test/3_yukicoder/1154.test.cpp
    title: test/3_yukicoder/1154.test.cpp
  - icon: ':x:'
    path: test/3_yukicoder/1441.test.cpp
    title: test/3_yukicoder/1441.test.cpp
  - icon: ':x:'
    path: test/3_yukicoder/1752.test.cpp
    title: test/3_yukicoder/1752.test.cpp
  - icon: ':x:'
    path: test/3_yukicoder/2292.test.cpp
    title: test/3_yukicoder/2292.test.cpp
  - icon: ':x:'
    path: test/3_yukicoder/2809.test.cpp
    title: test/3_yukicoder/2809.test.cpp
  - icon: ':x:'
    path: test/3_yukicoder/686.test.cpp
    title: test/3_yukicoder/686.test.cpp
  - icon: ':x:'
    path: test/3_yukicoder/789_2.test.cpp
    title: test/3_yukicoder/789_2.test.cpp
  - icon: ':x:'
    path: test/4_aoj/1508.test.cpp
    title: test/4_aoj/1508.test.cpp
  - icon: ':x:'
    path: test/4_aoj/1508_2.test.cpp
    title: test/4_aoj/1508_2.test.cpp
  _isVerificationFailed: true
  _pathExtension: hpp
  _verificationStatusIcon: ':question:'
  attributes:
    links: []
  bundledCode: "#line 1 \"ds/node_pool.hpp\"\ntemplate <class Node>\nstruct Node_Pool\
    \ {\n  struct Slot {\n    union alignas(Node) {\n      Slot* next;\n      unsigned\
    \ char storage[sizeof(Node)];\n    };\n  };\n  using np = Node*;\n\n  static constexpr\
    \ int CHUNK_SIZE = 1 << 16;\n\n  vc<unique_ptr<Slot[]>> chunks;\n  Slot* cur =\
    \ nullptr;\n  int cur_used = 0;\n  Slot* free_head = nullptr;\n\n  Node_Pool()\
    \ { alloc_chunk(); }\n\n  template <class... Args>\n  np create(Args&&... args)\
    \ {\n    Slot* s = new_slot();\n    return ::new (s) Node(forward<Args>(args)...);\n\
    \  }\n\n  np clone(const np x) {\n    assert(x);\n    Slot* s = new_slot();\n\
    \    return ::new (s) Node(*x);  // \u30B3\u30D4\u30FC\u30B3\u30F3\u30B9\u30C8\
    \u30E9\u30AF\u30BF\u547C\u3073\u51FA\u3057\n  }\n\n  void destroy(np x) {\n  \
    \  if (!x) return;\n    x->~Node();\n    auto s = reinterpret_cast<Slot*>(x);\n\
    \    s->next = free_head;\n    free_head = s;\n  }\n\n  void reset() {\n    free_head\
    \ = nullptr;\n    if (!chunks.empty()) {\n      cur = chunks[0].get();\n     \
    \ cur_used = 0;\n    }\n  }\n\n private:\n  void alloc_chunk() {\n    chunks.emplace_back(make_unique<Slot[]>(CHUNK_SIZE));\n\
    \    cur = chunks.back().get();\n    cur_used = 0;\n  }\n\n  Slot* new_slot()\
    \ {\n    if (free_head) {\n      Slot* s = free_head;\n      free_head = free_head->next;\n\
    \      return s;\n    }\n    if (cur_used == CHUNK_SIZE) alloc_chunk();\n    return\
    \ &cur[cur_used++];\n  }\n};\n"
  code: "template <class Node>\nstruct Node_Pool {\n  struct Slot {\n    union alignas(Node)\
    \ {\n      Slot* next;\n      unsigned char storage[sizeof(Node)];\n    };\n \
    \ };\n  using np = Node*;\n\n  static constexpr int CHUNK_SIZE = 1 << 16;\n\n\
    \  vc<unique_ptr<Slot[]>> chunks;\n  Slot* cur = nullptr;\n  int cur_used = 0;\n\
    \  Slot* free_head = nullptr;\n\n  Node_Pool() { alloc_chunk(); }\n\n  template\
    \ <class... Args>\n  np create(Args&&... args) {\n    Slot* s = new_slot();\n\
    \    return ::new (s) Node(forward<Args>(args)...);\n  }\n\n  np clone(const np\
    \ x) {\n    assert(x);\n    Slot* s = new_slot();\n    return ::new (s) Node(*x);\
    \  // \u30B3\u30D4\u30FC\u30B3\u30F3\u30B9\u30C8\u30E9\u30AF\u30BF\u547C\u3073\
    \u51FA\u3057\n  }\n\n  void destroy(np x) {\n    if (!x) return;\n    x->~Node();\n\
    \    auto s = reinterpret_cast<Slot*>(x);\n    s->next = free_head;\n    free_head\
    \ = s;\n  }\n\n  void reset() {\n    free_head = nullptr;\n    if (!chunks.empty())\
    \ {\n      cur = chunks[0].get();\n      cur_used = 0;\n    }\n  }\n\n private:\n\
    \  void alloc_chunk() {\n    chunks.emplace_back(make_unique<Slot[]>(CHUNK_SIZE));\n\
    \    cur = chunks.back().get();\n    cur_used = 0;\n  }\n\n  Slot* new_slot()\
    \ {\n    if (free_head) {\n      Slot* s = free_head;\n      free_head = free_head->next;\n\
    \      return s;\n    }\n    if (cur_used == CHUNK_SIZE) alloc_chunk();\n    return\
    \ &cur[cur_used++];\n  }\n};"
  dependsOn: []
  isVerificationFile: false
  path: ds/node_pool.hpp
  requiredBy:
  - string/aho_corasick_for_general_trie.hpp
  - ds/dynamic_array.hpp
  - ds/binary_trie.hpp
  - ds/sortable_array.hpp
  - ds/segtree/dynamic_lazy_segtree.hpp
  - ds/segtree/sortable_segtree.hpp
  - ds/segtree/dynamic_dual_segtree.hpp
  - ds/randomized_bst/rbst_acted_monoid.hpp
  - ds/randomized_bst/rbst_acted_set.hpp
  - ds/randomized_bst/rbst.hpp
  - ds/randomized_bst/rbst_commutative_monoid.hpp
  - ds/randomized_bst/rbst_monoid.hpp
  - ds/meldable_heap.hpp
  - ds/piecewise_constant/piecewise_constant.hpp
  - ds/piecewise_constant/piecewise_constant_acted_RMQ.hpp
  - ds/piecewise_constant/piecewise_constant_basic.hpp
  - ds/piecewise_constant/piecewise_constant_acted.hpp
  - ds/unionfind/dynamic_unionfind.hpp
  - ds/splaytree/splaytree.hpp
  - ds/splaytree/splaytree_commutative_monoid.hpp
  - ds/splaytree/splaytree_acted_monoid.hpp
  - ds/splaytree/splaytree_basic.hpp
  - ds/splaytree/splaytree_acted_set.hpp
  - ds/splaytree/splaytree_monoid.hpp
  - graph/shortest_path/K_shortest_walk.hpp
  - geo/polygon_triangulation.hpp
  - convex/dynamic_lichao.hpp
  - convex/slope_trick/slope_super.hpp
  - seq/cycle_decomposition.hpp
  timestamp: '2025-09-16 20:23:00+09:00'
  verificationStatus: LIBRARY_SOME_WA
  verifiedWith:
  - test/3_yukicoder/1441.test.cpp
  - test/3_yukicoder/2292.test.cpp
  - test/3_yukicoder/789_2.test.cpp
  - test/3_yukicoder/1752.test.cpp
  - test/3_yukicoder/1154.test.cpp
  - test/3_yukicoder/2809.test.cpp
  - test/3_yukicoder/686.test.cpp
  - test/1_mytest/rbst_monoid.test.cpp
  - test/1_mytest/splay.test.cpp
  - test/1_mytest/rbst.test.cpp
  - test/1_mytest/rbst_am_2.test.cpp
  - test/1_mytest/cf702_F_splay.test.cpp
  - test/1_mytest/cf702_F.test.cpp
  - test/1_mytest/splay_monoid.test.cpp
  - test/1_mytest/rbst_commutative_persistent.test.cpp
  - test/1_mytest/polygon_triangulation.test.cpp
  - test/1_mytest/rbst_monoid_persistent.test.cpp
  - test/1_mytest/sortable_array.test.cpp
  - test/1_mytest/rbst_test.test.cpp
  - test/1_mytest/slope_super.test.cpp
  - test/1_mytest/binary_trie.test.cpp
  - test/1_mytest/splay_cm.test.cpp
  - test/1_mytest/ARC30D.test.cpp
  - test/1_mytest/rbst_am.test.cpp
  - test/1_mytest/dynamic_lazy_segtree_persistent.test.cpp
  - test/1_mytest/dynamic_lazy_segtree.test.cpp
  - test/1_mytest/rbst_am_persistent.test.cpp
  - test/1_mytest/rbst_monoid_2.test.cpp
  - test/1_mytest/splay_am.test.cpp
  - test/4_aoj/1508.test.cpp
  - test/4_aoj/1508_2.test.cpp
  - test/2_library_checker/data_structure/sort_segtree.test.cpp
  - test/2_library_checker/data_structure/dynamic_sequence_range_affine_range_sum_splay.test.cpp
  - test/2_library_checker/data_structure/persistent_unionfind.test.cpp
  - test/2_library_checker/data_structure/set_xor_min.test.cpp
  - test/2_library_checker/data_structure/persistent_queue.test.cpp
  - test/2_library_checker/data_structure/range_reverse_range_sum.test.cpp
  - test/2_library_checker/data_structure/line_add_get_min_lichao.test.cpp
  - test/2_library_checker/data_structure/persistent_range_affine_range_sum.test.cpp
  - test/2_library_checker/data_structure/dynamic_sequence_range_affine_range_sum_rbst.test.cpp
  - test/2_library_checker/data_structure/segment_add_get_min.test.cpp
  - test/2_library_checker/data_structure/sort_segtree_1.test.cpp
  - test/2_library_checker/graph/K_shortest_walk.test.cpp
documentation_of: ds/node_pool.hpp
layout: document
redirect_from:
- /library/ds/node_pool.hpp
- /library/ds/node_pool.hpp.html
title: ds/node_pool.hpp
---
